#include "ShaderGraphResultNode.h"

using namespace AOENGINE;

ShaderGraphResultNode::~ShaderGraphResultNode() {
	resource_ = nullptr;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShaderGraphResultNode::Init() {
	// inputの設定
	addIN<AOENGINE::DxResource*>("DxResource", resource_, ImFlow::ConnectionFilter::SameType());
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShaderGraphResultNode::customUpdate() {
	// 入力からの受け取り
	resource_ = getInVal<AOENGINE::DxResource*>("DxResource");
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ node描画の際にする処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShaderGraphResultNode::draw() {
	if (resource_) {
		if (resource_->GetResource()) {
			ImTextureID texID = (ImTextureID)(intptr_t)(resource_->GetSRV().handleGPU.ptr);
			ImGui::SetNextWindowBgAlpha(0.85f);
			ImGui::Image(texID, ImVec2(64, 64));
		}
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ json形式に変換
///////////////////////////////////////////////////////////////////////////////////////////////

nlohmann::json ShaderGraphResultNode::toJson() {
	nlohmann::json result;
	BaseInfoToJson(result);
	return result;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ jsonから変換する
///////////////////////////////////////////////////////////////////////////////////////////////

void ShaderGraphResultNode::fromJson(const nlohmann::json& _json) {
	BaseInfoFromJson(_json);
}
