#include "BossActionShotMissile.h"
#include "Game/Actor/Boss/Boss.h"

#ifdef _DEBUG
void BossActionShotMissile::Debug_Gui() {
}
#endif // _DEBUG

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 設定時のみ行う処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossActionShotMissile::Build() {
	SetName("action Shot Missle");
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossActionShotMissile::OnStart() {
	actionTimer_ = 0.0f;
	bulletSpeed_ = 40.f;
	isFinishShot_ = false;

	fireCount_ = kFireCount_;

	shotInterval_ = 0.2f;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossActionShotMissile::OnUpdate() {
	actionTimer_ += GameTimer::DeltaTime();

	if (actionTimer_ > shotInterval_) {
		Shot();
		actionTimer_ = 0.0f;
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossActionShotMissile::OnEnd() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 次のアクションへの遷移確認
///////////////////////////////////////////////////////////////////////////////////////////////

void BossActionShotMissile::CheckNextAction() {
	if (isFinishShot_) {
		DeleteSelf();
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 入力確認処理
///////////////////////////////////////////////////////////////////////////////////////////////

bool BossActionShotMissile::IsInput() {
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 弾を打つ処理をする
///////////////////////////////////////////////////////////////////////////////////////////////

void BossActionShotMissile::Shot() {
	fireCount_--;

	Vector3 pos = pOwner_->GetTransform()->translate_;
	Vector3 forward = pOwner_->GetTransform()->rotation_.MakeForward();
	Vector3 up = pOwner_->GetTransform()->rotation_.MakeUp(); // Y軸に限らず回転軸として使う

	Vector3 velocity = forward.Normalize() * bulletSpeed_;
	pOwner_->GetBulletManager()->AddBullet<BossMissile>(pos, velocity, pOwner_->GetPlayerPosition(), bulletSpeed_);

	if (fireCount_ == 0) {
		isFinishShot_ = true;
	}
}