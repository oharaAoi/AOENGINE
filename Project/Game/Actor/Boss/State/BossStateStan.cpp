#include "BossStateStan.h"
#include "Engine/System/Audio/AudioPlayer.h"
#include "Game/Actor/Boss/Boss.h"
#include "Game/Actor/Boss/State/BossStateNormal.h"
#include "Game/UI/Boss/BossUIs.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossStateStan::OnStart() {
	SetName("StanState");

	stateTime_ = 0.0f;
	param_.SetGroupName(stateMachine_->GetName());
	param_.Load();

	pOwner_->GetGameObject()->GetRigidbody()->SetGravity(true);

	pOwner_->SetIsStan(true);
	pOwner_->SetExecute(false);

	AudioPlayer::SinglShotPlay("stan_se.mp3", 0.4f);
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossStateStan::OnUpdate() {
	stateTime_ += GameTimer::DeltaTime();
	pOwner_->SetStanRemainingTime(stateTime_ / param_.stanTime);

	if (stateTime_ >= param_.stanTime) {
		stateMachine_->ChangeState<BossStateNormal>();
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void BossStateStan::OnExit() {
	pOwner_->GetGameObject()->GetRigidbody()->SetGravity(false);

	pOwner_->ResetStan();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集
///////////////////////////////////////////////////////////////////////////////////////////////

void BossStateStan::Debug_Gui() {
	param_.Debug_Gui();
}

void BossStateStan::Parameter::Debug_Gui() {
	ImGui::DragFloat("stanTime", &stanTime, 0.1f);
	SaveAndLoad();
}