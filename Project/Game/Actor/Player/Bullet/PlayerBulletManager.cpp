#include "PlayerBulletManager.h"

PlayerBulletManager::~PlayerBulletManager() {
	bulletList_.clear();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerBulletManager::Init() {
	bulletList_.clear();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerBulletManager::Update() {
	// フラグがfalseになったら削除
	std::erase_if(bulletList_, [](const PlayerBullet& bullet) {
		return !bullet.GetIsAlive();
				  });

	for (PlayerBullet& bullet : bulletList_) {
		bullet.Update();
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 描画
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerBulletManager::Draw() const {
	for (const PlayerBullet& bullet : bulletList_) {
		bullet.Draw();
	}
}

void PlayerBulletManager::CollisionToBoss(const Vector3& bossPos) {
	for (PlayerBullet& bullet : bulletList_) {
		float length = (bullet.GetTransform()->translate_ - bossPos).Length();

		if (length < 2.0f) {
			// effectを出す
			bullet.SetIsAlive(false);
		}
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 弾を追加する
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerBulletManager::AddBullet(const Vector3& pos, const Vector3& velocity) {
	PlayerBullet& bullet = bulletList_.emplace_back();
	bullet.Init();
	bullet.Reset(pos, velocity);
}
