#include "PlayerActionDeployArmor.h"
#include "Game/Actor/Player/Player.h"
#include "Game/Actor/Player/Action/PlayerActionIdle.h"
#include "Engine/System/Manager/GpuParticleManager.h"
#include "Engine/Lib/Json/JsonItems.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionDeployArmor::Debug_Gui() {
	parameter_.Debug_Gui();
}

void PlayerActionDeployArmor::Parameter::Debug_Gui() {
	ImGui::DragFloat("chargeTime", &chargeTime, 01.f);
	ImGui::DragFloat3("effectOffset", &effectOffset.x, 0.1f);
	SaveAndLoad();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 設定処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionDeployArmor::Build() {
	SetName("ActionDeployArmor");
	pInput_ = Input::GetInstance();

	parameter_.SetGroupName(pManager_->GetName());
	parameter_.Load();

	/*chargeEmitter_ = GpuParticleManager::GetInstance()->CreateEmitter("concentration");
	chargeEmitter_->SetIsStop(true);
	chargeEmitter_->SetParent(pOwner_->GetTransform()->GetWorldMatrix());
	chargeEmitter_->SetLocalPos(parameter_.effectOffset);*/
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionDeployArmor::OnStart() {
	actionTimer_ = 0.0f;
	//chargeEmitter_->SetIsStop(false);
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionDeployArmor::OnUpdate() {
	actionTimer_ += GameTimer::DeltaTime();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionDeployArmor::OnEnd() {
	pOwner_->SetDeployArmor(true);
	//chargeEmitter_->SetIsStop(true);
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 次のアクション確認
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionDeployArmor::CheckNextAction() {
	if (actionTimer_ > 2.0f) {
		NextAction<PlayerActionIdle>();
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 入力処理
///////////////////////////////////////////////////////////////////////////////////////////////

bool PlayerActionDeployArmor::IsInput() {
	if (pInput_->IsTriggerButton(XInputButtons::RSTICK_THUMB)) {
		return true;
	}
	return false;
}
