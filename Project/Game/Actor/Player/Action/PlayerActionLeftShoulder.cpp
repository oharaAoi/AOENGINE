#include "PlayerActionLeftShoulder.h"
#include "Game/Actor/Player/Player.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 設定時のみ行う処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::Build() {
	SetName("ActionLeftShoulder");
	pInput_ = Input::GetInstance();
	pWeapon_ = dynamic_cast<LaserRifle*>(pOwner_->GetWeapon(PlayerWeapon::Left_Shoulder));
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::OnStart() {
	isFinish_ = false;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::OnUpdate() {
	Shot();

	pOwner_->LookTarget(1.0f, pOwner_->GetReticle()->GetLockOn());

	isFinish_ = true;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::OnEnd() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 次のアクションの確認
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::CheckNextAction() {
	if (isFinish_) {
		DeleteSelf();
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 入力確認
///////////////////////////////////////////////////////////////////////////////////////////////

bool PlayerActionLeftShoulder::IsInput() {
	if (pInput_->IsTriggerButton(XInputButtons::LtShoulder)) {
		return true;
	}
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::Debug_Gui() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 攻撃処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionLeftShoulder::Shot() {
	if (pOwner_->GetIsLockOn()) {
		pWeapon_->Attack(AttackContext(CVector3::ZERO, pOwner_->GetTargetPos()));
	} else {
		Vector3 dire = pOwner_->GetTransform()->srt_.rotate.MakeForward();
		pWeapon_->Attack(AttackContext(CVector3::ZERO, dire));
	}
}