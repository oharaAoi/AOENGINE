#include "PlayerActionShotLeft.h"
#include "Game/Actor/Player/Player.h"
#include "Game/Actor/Player/Action/PlayerActionIdle.h"
// Engine
#include "Engine/Lib/GameTimer.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 設定時のみ行う処理
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionShotLeft::Build() {
	SetName("actionShotLeft");
	pInput_ = Input::GetInstance();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionShotLeft::OnStart() {
	shotTimer_ = 0.0f;
	notShotTimer_ = 0.0f;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionShotLeft::OnUpdate() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了
//////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionShotLeft::OnEnd() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 次に行うアクションの判定
//////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionShotLeft::CheckNextAction() {
	// ボタンを押して入なかったら待機状態に行く
	if (notShotTimer_ >= notShotTime_) {
		NextAction<PlayerActionIdle>();
	}
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 入力処理
///////////////////////////////////////////////////////////////////////////////////////////////

bool PlayerActionShotLeft::IsInput() {
	if (pInput_->GetIsPadTrigger(XInputButtons::L_SHOULDER)) {
		return true;
	}
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ main action
///////////////////////////////////////////////////////////////////////////////////////////////

void PlayerActionShotLeft::Shot() {
	// timerがゼロでなかったら新たに弾を撃たないようにして早期リターンする
	if (shotTimer_ > 0.0f) {
		shotTimer_ -= GameTimer::DeltaTime();
		return;
	} else {
		shotTimer_ = 0.0f;
	}

	// 長押しで反応するようにする
	if (pInput_->GetPressPadTrigger(XInputButtons::R_SHOULDER)) {
		// shotを放つ
		pOwner_->Shot(100.0f);

		// coolTimeの設定
		shotTimer_ = shotCoolTime_;
		notShotTimer_ = 0.0f;
	} else {
		// ボタンを押していない時間を計測
		notShotTimer_ += GameTimer::DeltaTime();
	}
}
