#include "EnemyActionApproach.h"
#include "Game/Actor/Enemy/BaseEnemy.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 実行処理
///////////////////////////////////////////////////////////////////////////////////////////////

BehaviorStatus EnemyActionApproach::Execute() {
    return Action();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 重みを計算
///////////////////////////////////////////////////////////////////////////////////////////////

float EnemyActionApproach::EvaluateWeight() {
    return 0.0f;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionApproach::Debug_Gui() {
    BaseTaskNode::Debug_Gui();
    param_.Debug_Gui();
}

void EnemyActionApproach::Parameter::Debug_Gui() {
    ImGui::DragFloat("speed", &speed, 0.1f);
    ImGui::DragFloat("limitDistance", &limitDistance, 0.1f);
    SaveAndLoad();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了確認
///////////////////////////////////////////////////////////////////////////////////////////////

bool EnemyActionApproach::IsFinish() {
    Math::Vector3 distance = pTarget_->GetTargetTransform()->GetPos() - pTarget_->GetTransform()->GetPos();
    if (distance.Length() <= param_.limitDistance) {
        return true;
    }
    return false;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 実行確認
///////////////////////////////////////////////////////////////////////////////////////////////

bool EnemyActionApproach::CanExecute() {
    return true;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionApproach::Init() {
    param_.Load();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionApproach::Update() {
    pTarget_->TargetLook();

    Math::Vector3 direction = pTarget_->GetTargetTransform()->GetPos() - pTarget_->GetTransform()->GetPos();
    direction = direction.Normalize();

    pTarget_->GetTransform()->MoveVelocity(direction * param_.speed * AOENGINE::GameTimer::DeltaTime(), 1.0f);
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionApproach::End() {
}
