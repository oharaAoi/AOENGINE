#include "EnemyActionWalk.h"
#include "Engine/Lib/Math/MyRandom.h"
#include "Game/Actor/Enemy/BaseEnemy.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 実行処理
///////////////////////////////////////////////////////////////////////////////////////////////

BehaviorStatus EnemyActionWalk::Execute() {
	return Action();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 重みを計算
///////////////////////////////////////////////////////////////////////////////////////////////

float EnemyActionWalk::EvaluateWeight() {
	return 0.0f;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionWalk::Debug_Gui() {
	BaseTaskNode::Debug_Gui();
	param_.Debug_Gui();
}

void EnemyActionWalk::Parameter::Debug_Gui() {
	ImGui::DragFloat("速度", &speed, 0.1f);
	ImGui::DragFloat("方向転換時間", &changeDirectionTime, 0.1f);
	SaveAndLoad();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了確認
///////////////////////////////////////////////////////////////////////////////////////////////

bool EnemyActionWalk::IsFinish() {
	return false;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 実行確認
///////////////////////////////////////////////////////////////////////////////////////////////

bool EnemyActionWalk::CanExecute() {
	return true;
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionWalk::Init() {
	param_.Load();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionWalk::Update() {
	taskTimer_ += AOENGINE::GameTimer::DeltaTime();

	if (taskTimer_ >= param_.changeDirectionTime) {
		taskTimer_ = 0;
		direction_ = Random::RandomVector3(Math::Vector3(-1, 0, -1), Math::Vector3::Vector3(1, 0, 1)).Normalize();
	}

	pTarget_->GetTransform()->MoveVelocity(direction_ * param_.speed * AOENGINE::GameTimer::DeltaTime(), 1.0f);
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void EnemyActionWalk::End() {
}
