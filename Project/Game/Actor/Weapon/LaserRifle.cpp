#include "LaserRifle.h"
#include "Engine/System/Manager/ParticleManager.h"
#include "Engine/System/Editor/Window/EditorWindows.h"
#include "Game/Actor/Weapon/Bullet/LaserBullet.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集
///////////////////////////////////////////////////////////////////////////////////////////////

void LaserRifle::Debug_Gui() {
	weaponParam_.Debug_Gui();
	BaseWeapon::Debug_Gui();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了
///////////////////////////////////////////////////////////////////////////////////////////////

void LaserRifle::Finalize() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化
///////////////////////////////////////////////////////////////////////////////////////////////

void LaserRifle::Init() {
	// 初期化と保存項目の取得
	SetName("LaserRifle");
	BaseWeapon::Init();
	attackParam_.SetName("LaserRifleAttackParam");
	attackParam_.Load();
	weaponParam_.Load();

	object_->SetObject("gun.obj", MaterialType::PBR);
	transform_->SetTranslate(weaponParam_.pos);

}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 攻撃
///////////////////////////////////////////////////////////////////////////////////////////////

bool LaserRifle::Attack(const AttackContext& cxt) {
	if (!isCanAttack_) { return false; }

	Math::Vector3 worldPos = object_->GetPosition();
	LaserBullet* bullet = pBulletManager_->AddBullet<LaserBullet>(worldPos, cxt.target, attackParam_.bulletSpeed);
	bullet->SetTakeDamage(attackParam_.takeDamage);

	AttackAfter();
	return true;
}

void LaserRifle::LaserRifleParam::Debug_Gui() {
	ImGui::DragFloat3("pos", &pos.x, 0.1f);
	SaveAndLoad();
}
