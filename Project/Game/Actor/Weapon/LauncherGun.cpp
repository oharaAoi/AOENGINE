#include "LauncherGun.h"
#include "Engine/System/Manager/ParticleManager.h"

void LauncherGun::Finalize() {
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集
///////////////////////////////////////////////////////////////////////////////////////////////
#ifdef _DEBUG
void LauncherGun::Debug_Gui() {
}
#endif // _DEBUG

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化
///////////////////////////////////////////////////////////////////////////////////////////////

void LauncherGun::Init() {
	BaseWeapon::Init();
	object_->SetObject("launcher.obj");
	SetName("LauncherGun");

	transform_->translate_ = { -1.2f, 1.1f, 0.0f };

	// -------------------------------------------------
	// ↓ Effect関連
	// -------------------------------------------------

	gunFireParticles_ = ParticleManager::GetInstance()->CrateParticle("gunFireParticles");

#ifdef _DEBUG
	EditorWindows::AddObjectWindow(this, GetName());
#endif // _DEBUG
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 更新
///////////////////////////////////////////////////////////////////////////////////////////////

void LauncherGun::Update() {
	gunFireParticles_->Update();
	BaseWeapon::Update();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 描画
///////////////////////////////////////////////////////////////////////////////////////////////

void LauncherGun::Draw() const {
	BaseWeapon::Draw();
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 弾を撃つ
///////////////////////////////////////////////////////////////////////////////////////////////
 
void LauncherGun::Shot(const Vector3& targetPos, uint32_t type) {
	Vector3 worldPos = object_->GetPosition();
	Vector3 dire = (targetPos - worldPos).Normalize();
	pBulletManager_->AddBullet(worldPos, dire * speed_, type);
	// effectを出す
	Vector3 pos = worldPos;
	pos += (dire * 4.f);
	gunFireParticles_->SetPos(pos);
	gunFireParticles_->SetIsStop(false);
}