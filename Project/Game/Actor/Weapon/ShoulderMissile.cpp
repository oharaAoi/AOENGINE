#include "ShoulderMissile.h"
#include "Engine/Lib/Json/JsonItems.h"
#include "Game/Actor/Weapon/Bullet/RocketBullet.h"

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShoulderMissile::Finalize() {

}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 初期化処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShoulderMissile::Init() {
	SetName("ShoulderMissile");
	BaseWeapon::Init();
	object_->SetObject("shoulderMissile.obj");

	param_.FromJson(JsonItems::GetData(GetName(), param_.GetName()));
	transform_->SetTranslaion(param_.pos);

	EditorWindows::AddObjectWindow(this, GetName());
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 編集処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShoulderMissile::Debug_Gui() {
	BaseWeapon::Debug_Gui();
	ImGui::DragFloat3("pos", &param_.pos.x, 0.1f);

	if (ImGui::Button("Save")) {
		JsonItems::Save(GetName(), param_.ToJson(param_.GetName()));
	}
	transform_->SetTranslaion(param_.pos);
}

///////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 攻撃処理
///////////////////////////////////////////////////////////////////////////////////////////////

void ShoulderMissile::Attack(const AttackContext& cxt) {
	Vector3 worldPos = object_->GetPosition();
	RocketBullet* bullet = pBulletManager_->AddBullet<RocketBullet>(worldPos, cxt.target, speed_);
	bullet->SetTakeDamage(20.0f);
}
