#include "Bomb.h"

Bomb::Bomb() {}
Bomb::~Bomb() {}

//////////////////////////////////////////////////////////////////////////////////////////////////
// ↓ 終了処理
//////////////////////////////////////////////////////////////////////////////////////////////////

void Bomb::Finalize() {
}

//////////////////////////////////////////////////////////////////////////////////////////////////
// ↓　初期化処理
//////////////////////////////////////////////////////////////////////////////////////////////////

void Bomb::Init() {
	BaseGameObject::Init();
	SetObject("bomb.obj");

	// Colliderの生成
	SetMeshCollider("bomb");
	meshCollider_->SetCollisionEnter([this](MeshCollider& other) {OnCollisionEnter(other); });
	meshCollider_->SetCollisionStay([this](MeshCollider& other) {OnCollisionStay(other); });
	meshCollider_->SetCollisionExit([this](MeshCollider& other) {OnCollisionExit(other); });

	isAlive_ = true;

	acceleration_ = Vector3::ZERO();
}

//////////////////////////////////////////////////////////////////////////////////////////////////
// ↓　更新処理
//////////////////////////////////////////////////////////////////////////////////////////////////

void Bomb::Update() {
	velocity_ += acceleration_ * GameTimer::DeltaTime();
	Vector3 pos = transform_->GetTranslation();
	pos += velocity_;
	transform_->SetTranslaion(pos);

	BaseGameObject::Update();
}

//////////////////////////////////////////////////////////////////////////////////////////////////
// ↓　描画処理
//////////////////////////////////////////////////////////////////////////////////////////////////

void Bomb::Draw() const {
	BaseGameObject::Draw();
}

//////////////////////////////////////////////////////////////////////////////////////////////////
// ↓　出現させる
//////////////////////////////////////////////////////////////////////////////////////////////////

void Bomb::Pop(const Vector3& pos, const Vector3& acceleration) {
	transform_->SetTranslaion(pos);
	acceleration_ = acceleration;
	velocity_ = Vector3::ZERO();
}

#ifdef _DEBUG
void Bomb::Debug_Draw() {
	meshCollider_->Draw();
}
#endif

//////////////////////////////////////////////////////////////////////////////////////////////////
// ↓　衝突判定用処理
//////////////////////////////////////////////////////////////////////////////////////////////////

void Bomb::OnCollisionEnter([[maybe_unused]] MeshCollider& other) {
	if (other.GetTag() == "right_hand" || other.GetTag() == "left_hand") {
		if (other.GetSubTag() != "wait_attack") {
			isAlive_ = false;
		}
	} else if (other.GetTag() == "field") {
		acceleration_ = Vector3::ZERO();
		velocity_ = Vector3::ZERO();
	}
}

void Bomb::OnCollisionStay([[maybe_unused]] MeshCollider& other) {
}

void Bomb::OnCollisionExit([[maybe_unused]] MeshCollider& other) {
}
